<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Oracle Storage Upload/Delete Test</title>
</head>
<body>
  <h2>Oracle Upload/Delete Test</h2>

  <input type="file" id="fileInput" />
  <button id="uploadBtn">Upload</button>
  <button id="deleteBtn">Delete</button>

  <pre id="output"></pre>

  <script>
    let PAR_URL = "";

    async function init() {
      const config = await fetch("http://localhost:4000/api/config").then(r => r.json());
      PAR_URL = config.parUrl;
    }
    init();

    document.getElementById("uploadBtn").onclick = async () => {
      const file = document.getElementById("fileInput").files[0];
      const output = document.getElementById("output");

      if (!file) {
        output.textContent = "❌ Choose a file first";
        return;
      }

      output.textContent = "Uploading...";

      try {
        const res = await fetch(PAR_URL + encodeURIComponent(file.name), {
          method: "PUT",
          headers: { "Content-Type": file.type || "application/octet-stream" },
          body: file
        });

        if (res.ok) {
          output.textContent = `✅ Uploaded successfully!\n${PAR_URL + file.name}`;
        } else {
          output.textContent = `❌ Upload failed. Status: ${res.status}`;
        }
      } catch (err) {
        output.textContent = `❌ Error: ${err.message}`;
      }
    };

    document.getElementById("deleteBtn").onclick = async () => {
      const file = document.getElementById("fileInput").files[0];
      const output = document.getElementById("output");

      if (!file) {
        output.textContent = "❌ Select a file to delete (by name)";
        return;
      }

      output.textContent = "Deleting...";

      try {
        const res = await fetch(`http://localhost:4000/api/delete/${encodeURIComponent(file.name)}`, {
          method: "DELETE"
        });

        const data = await res.json();
        if (data.success) {
          output.textContent = `✅ Deleted ${file.name}`;
        } else {
          output.textContent = `❌ Delete failed: ${data.message}`;
        }
      } catch (err) {
        output.textContent = `❌ Error: ${err.message}`;
      }
    };
  </script>
</body>
</html>
